generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  SUPER_ADMIN
  ORG_ADMIN
  RECRUITER
  VIEWER
}

enum GroupStatus {
  ACTIVE
  INACTIVE
  PENDING
}

enum JoinRequestStatus {
  PENDING
  APPROVED
  REJECTED
}

model User {
  id              Int           @id @default(autoincrement())
  name            String
  email           String        @unique
  hashed_password String
  role            Role          @default(VIEWER)
  organizationId  Int?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  Keywords        Keyword[]
  SavedSearches   SavedSearch[]
  Organization    Organization? @relation(fields: [organizationId], references: [id])
  Groups          UserGroup[]
  joinRequests    JoinRequest[]
}

model Organization {
  id             Int           @id @default(autoincrement())
  name           String
  users          User[]
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  joinRequests   JoinRequest[]
}

model Group {
  id            Int          @id @default(autoincrement())
  name          String
  linkedinUrl   String       @unique
  status        GroupStatus  @default(ACTIVE)
  scheduledHour Int?         // 0-23, השעה בה יש להריץ
  timezone      String?      // לדוגמה: "Asia/Jerusalem"
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  JobPostings   JobPosting[]
  Users         UserGroup[]
}

model UserGroup {
  userId   Int
  groupId  Int
  joinedAt DateTime @default(now())
  Group    Group    @relation(fields: [groupId], references: [id])
  User     User     @relation(fields: [userId], references: [id])

  @@id([userId, groupId])
}

model JobPosting {
  id          Int          @id @default(autoincrement())
  title       String
  company     String
  description String
  link        String
  location    String?
  postingDate DateTime
  language    String?
  isArchived  Boolean      @default(false)
  groupId     Int
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  JobKeywords JobKeyword[]
  Group       Group        @relation(fields: [groupId], references: [id])
}

model Keyword {
  id          Int          @id @default(autoincrement())
  word        String
  weight      Int          @default(1)
  userId      Int
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  JobKeywords JobKeyword[]
  User        User         @relation(fields: [userId], references: [id])

  @@unique([word, userId])
}

model JobKeyword {
  jobId     Int
  keywordId Int
  Job       JobPosting @relation(fields: [jobId], references: [id])
  Keyword   Keyword    @relation(fields: [keywordId], references: [id])

  @@id([jobId, keywordId])
}

model SavedSearch {
  id        Int      @id @default(autoincrement())
  userId    Int
  name      String
  keywords  String[]
  daysRange Int
  createdAt DateTime @default(now())
  User      User     @relation(fields: [userId], references: [id])
}

model JoinRequest {
  id              Int                 @id @default(autoincrement())
  user            User               @relation(fields: [userId], references: [id])
  userId          Int
  organization    Organization       @relation(fields: [organizationId], references: [id])
  organizationId  Int
  status          JoinRequestStatus  @default(PENDING)
  createdAt       DateTime           @default(now())
}
