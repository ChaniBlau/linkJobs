generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  SUPER_ADMIN
  ORG_ADMIN
  RECRUITER
  VIEWER
}

enum GroupStatus {
  ACTIVE
  INACTIVE
  PENDING
}

model User {
  id              Int          @id @default(autoincrement())
  name            String
  email           String       @unique
  hashed_password String
  role            Role         @default(VIEWER)
  organizationId  Int?         
  Organization    Organization? @relation(fields: [organizationId], references: [id])

  Keywords        Keyword[]
  SavedSearches   SavedSearch[]
  Groups          UserGroup[]     // קשר Many-to-Many לקבוצות
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
}

model Organization {
  id          Int          @id @default(autoincrement())
  name        String
  users       User[]
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
}

model Group {
  id          Int          @id @default(autoincrement())
  name        String
  linkedinUrl String       @unique
  status      GroupStatus  @default(ACTIVE)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  scheduledHour Int?    // לדוג' 8 = 8 בבוקר מקומי
  timezone      String? // לדוג' 'Asia/Jerusalem' או 'America/New_York'

  JobPostings JobPosting[]
  Users       UserGroup[]
}

model UserGroup {
  userId  Int
  groupId Int

  User    User  @relation(fields: [userId], references: [id])
  Group   Group @relation(fields: [groupId], references: [id])

  joinedAt DateTime @default(now())

  @@id([userId, groupId])
}

model JobPosting {
  id          Int          @id @default(autoincrement())
  title       String
  company     String
  description String
  link        String
  location    String?
  postingDate DateTime
  language    String?
  isArchived  Boolean      @default(false)

  groupId     Int
  Group       Group        @relation(fields: [groupId], references: [id])
  JobKeywords JobKeyword[]
  
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
}

model Keyword {
  id          Int          @id @default(autoincrement())
  word        String
  weight      Int          @default(1)
  userId      Int
  User        User         @relation(fields: [userId], references: [id])
  JobKeywords JobKeyword[]
  
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  @@unique([word, userId])
}

model JobKeyword {
  jobId     Int
  keywordId Int
  Job       JobPosting @relation(fields: [jobId], references: [id])
  Keyword   Keyword    @relation(fields: [keywordId], references: [id])

  @@id([jobId, keywordId])
}

model SavedSearch {
  id        Int      @id @default(autoincrement())
  userId    Int
  name      String
  keywords  String[] 
  daysRange Int  
  createdAt DateTime @default(now())

  User User @relation(fields: [userId], references: [id])
}
